# WetLSP Pixel-Level Time Series (Parquet)

#Overview

This directory contains pixel-level EVI time-series data derived from the WetLSP (Wetland Land Surface Phenology) processing pipeline applied to PlanetScope imagery.

The data are provided in Apache Parquet format to enable:  

	*	fast, memory-efficient querying
	*	interactive visualization (e.g. Shiny, Python, JS)
	*	cloud-native access (Arrow / DuckDB / Spark)

These Parquet datasets are scientifically equivalent to the companion sf .rds files distributed with this site, but are optimized for scalable access.

##Directory Structure

tables_sf_fetch_<RADIUS>m/
├── pixels_geom_ds/          # Geometry dataset (pixel locations)
│   ├── geom_batch_001.parquet
│   ├── geom_batch_002.parquet
│   └── ...
├── pixels_timeseries_ds/    # Long-format EVI time series
│   ├── ts_batch_001.parquet
│   ├── ts_batch_002.parquet
│   └── ...
├── pixels_meta_ds/
│   └── meta.parquet         # CRS and site metadata
└── README.md

## Geometry Dataset (pixels_geom_ds)

One row per pixel.

column	type	description
pixel_id	int	Stable unique pixel identifier
cell	int	Original WetLSP cell index
x	double	Projected x coordinate
y	double	Projected y coordinate  

	*	Coordinates are in the projected CRS used by WetLSP (typically UTM).
	*	CRS is stored in pixels_meta_ds/meta.parquet as WKT.
	*	Geometry can be reconstructed as points using (x, y).

## Time Series Dataset (pixels_timeseries_ds)

Long table: one row per pixel × date × series.

column	type	description
pixel_id	int	Pixel identifier (joins to geometry)
series	string	"spline" or "raw"
date	date	Observation date
year	int	Calendar year
evi	double	Enhanced Vegetation Index

Notes:  

	*	"spline" represents gap-filled daily EVI.
	*	"raw" represents observed (non-gap-filled) EVI where available.
	*	Not all pixels have data for all years.
	*	Typical full-coverage pixels have 1825 days (5 years).

## Metadata (pixels_meta_ds/meta.parquet)

Key–value table with dataset-level metadata.

key	value  

  * crs_wkt	Well-Known Text CRS definition
  * site_id	Flux tower site ID
  * radius_m	Extraction radius (meters)

## Relationship to Other WetLSP Products

This Parquet dataset is a companion access layer to:
	*	WetLSP_<year>.nc
> phenometrics (spatial summary metrics only)
	*	<site>_evi_timeseries_fetch_sf_<RADIUS>m.rds>
> full sf object with list-columns for dates/EVI

All three products are derived from the same processing pipeline and are internally consistent.

## Typical Usage Patterns

Join geometry + time series (R)

library(arrow)
library(dplyr)

geom <- open_dataset("pixels_geom_ds") |> collect()
ts   <- open_dataset("pixels_timeseries_ds")

# Example: extract one year of spline data
ts_2022 <- ts |>
  filter(series == "spline", year == 2022) |>
  collect()

df <- left_join(ts_2022, geom, by = "pixel_id")

## Interactive apps
	*	Query by spatial window (via pixel_id)
	*	Query by date or year
	*	Aggregate per-pixel or per-region on the fly

## Performance Notes
	*	Parquet files are columnar and compressed (zstd).
	*	Best performance when queried with:
	*	Apache Arrow
	*	DuckDB
	*	Polars
	*	Spark
	*	Designed to avoid loading the full dataset into memory.

## Citation & Attribution

If you use these data, please cite:

Moon, M. et al. (2022) Wetland Land Surface Phenology from PlanetScope Imagery.
Scientific Data. https://doi.org/10.1038/s41597-022-01570-5

and acknowledge:

WetLSP processing and site-level products generated by the Ecosystem & Planetary Health Integration Lab (UIC).

## Contact and Author

For questions or issues:
	*	Gavin McNicol (gmcnicol@uic.edu)
	*	WetLSP GitHub: https://github.com/McNicol-Lab/WetLSP